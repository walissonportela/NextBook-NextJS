{"version":3,"sources":["../../../../../src/modules/cart/commands/handler/remove-product-from-cart.handler.ts"],"sourcesContent":["import { CommandHandler, ICommandHandler } from \"@nestjs/cqrs\";\nimport { RemoveProductFromCartImpl } from \"../impl/remove-product-from-cart.impl\";\nimport { PrismaService } from \"src/core/infra/database/prisma.service\";\nimport { NotFoundException } from \"@nestjs/common\";\n\n@CommandHandler(RemoveProductFromCartImpl)\nexport class RemoveProductFromCartHandler implements ICommandHandler<RemoveProductFromCartImpl> {\n    constructor(private readonly prismaService: PrismaService) {}\n\n    async execute(command: RemoveProductFromCartImpl) {\n        const { productId, userId } = command.data;\n\n        const cart = await this.prismaService.cart.findUnique({\n            where: {\n                userId\n            }\n        });\n\n        if (!cart) {\n            throw new NotFoundException('Cart not found');\n        }\n\n        const productInCart = await this.prismaService.productInCart.findFirst({\n            where: {\n                productId,\n                cartId: cart.id\n            },\n            include: {\n                product: true\n            }\n        });\n\n        if (!productInCart) {\n            throw new NotFoundException('Product not found in cart');\n        }\n\n        await this.prismaService.productInCart.delete({\n            where: {\n                productId_cartId: {\n                    productId,\n                    cartId: cart.id\n                }\n            }\n        });\n\n        return {\n            message: 'Product removed from cart successfully',\n            product: productInCart.product\n        };\n    }\n}\n"],"names":["RemoveProductFromCartHandler","execute","command","productId","userId","data","cart","prismaService","findUnique","where","NotFoundException","productInCart","findFirst","cartId","id","include","product","delete","productId_cartId","message"],"mappings":";;;;+BAMaA;;;eAAAA;;;sBANmC;2CACN;+BACZ;wBACI;;;;;;;;;;AAG3B,IAAA,AAAMA,+BAAN,MAAMA;IAGT,MAAMC,QAAQC,OAAkC,EAAE;QAC9C,MAAM,EAAEC,SAAS,EAAEC,MAAM,EAAE,GAAGF,QAAQG,IAAI;QAE1C,MAAMC,OAAO,MAAM,IAAI,CAACC,aAAa,CAACD,IAAI,CAACE,UAAU,CAAC;YAClDC,OAAO;gBACHL;YACJ;QACJ;QAEA,IAAI,CAACE,MAAM;YACP,MAAM,IAAII,yBAAiB,CAAC;QAChC;QAEA,MAAMC,gBAAgB,MAAM,IAAI,CAACJ,aAAa,CAACI,aAAa,CAACC,SAAS,CAAC;YACnEH,OAAO;gBACHN;gBACAU,QAAQP,KAAKQ,EAAE;YACnB;YACAC,SAAS;gBACLC,SAAS;YACb;QACJ;QAEA,IAAI,CAACL,eAAe;YAChB,MAAM,IAAID,yBAAiB,CAAC;QAChC;QAEA,MAAM,IAAI,CAACH,aAAa,CAACI,aAAa,CAACM,MAAM,CAAC;YAC1CR,OAAO;gBACHS,kBAAkB;oBACdf;oBACAU,QAAQP,KAAKQ,EAAE;gBACnB;YACJ;QACJ;QAEA,OAAO;YACHK,SAAS;YACTH,SAASL,cAAcK,OAAO;QAClC;IACJ;IA1CA,YAAY,AAAiBT,aAA4B,CAAE;aAA9BA,gBAAAA;IAA+B;AA2ChE"}